'use client';

import { useEffect, useRef, useState } from 'react';
import gsap from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

gsap.registerPlugin(ScrollTrigger);

function CountUpAnimation({ target, duration = 2000 }: { target: number; duration?: number }) {
  const [count, setCount] = useState(0);
  const elementRef = useRef<HTMLDivElement>(null);
  const hasAnimated = useRef(false);

  useEffect(() => {
    const element = elementRef.current;
    if (!element) return;

    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting && !hasAnimated.current) {
          hasAnimated.current = true;
          let startTime: number | null = null;
          const animate = (currentTime: number) => {
            if (!startTime) startTime = currentTime;
            const progress = Math.min((currentTime - startTime) / duration, 1);
            
            const easeOutQuart = 1 - Math.pow(1 - progress, 4);
            setCount(Math.floor(easeOutQuart * target));

            if (progress < 1) {
              requestAnimationFrame(animate);
            } else {
              setCount(target);
            }
          };
          requestAnimationFrame(animate);
        }
      },
      { threshold: 0.5 }
    );

    observer.observe(element);
    return () => observer.disconnect();
  }, [target, duration]);

  return <div ref={elementRef}>{count}</div>;
}

function TalentsShowcase() {
  const [typingText, setTypingText] = useState('');
  const [currentIndex, setCurrentIndex] = useState(0);
  const typingRef = useRef<NodeJS.Timeout>();

  const firstEightTalents = [
    'UKG kids learn English alphabet in 3 hrs',
    'UKG kids write exams without teacher help',
    'UKG kids identify all countries in world map',
    'UKG kids read English dailies',
    'LKG kids say capitals of all countries',
    'PKG kids answer 500+ GK questions',
    'Class 1 kids have 99% similar handwriting',
    'Class 5 students say day of any date in seconds',
  ];

  const remainingTalents = [
    'Class 2 kids have efficient Hindi handwriting',
    'Class 3 kids learn Telugu writing in 6 hours',
    'Class 3 kids recite 100 Telugu poems',
    'Class 3 kids have excellent Telugu handwriting',
    'Class 4 kids perform speed mental math',
    'Class 5 students calculate dates in seconds',
    'Class 5 students memorize hundreds of mobile numbers',
    'Class 5 students recall hundreds of objects',
    'Class 5 kids display photographic memory',
  ];

  useEffect(() => {
    const currentSentence = remainingTalents[currentIndex];
    let charIndex = 0;

    const typeChar = () => {
      if (charIndex < currentSentence.length) {
        setTypingText(currentSentence.substring(0, charIndex + 1));
        charIndex++;
        typingRef.current = setTimeout(typeChar, 50);
      } else {
        typingRef.current = setTimeout(() => {
          setCurrentIndex((prev) => (prev + 1) % remainingTalents.length);
          setTypingText('');
        }, 3000);
      }
    };

    typingRef.current = setTimeout(typeChar, 500);

    return () => {
      if (typingRef.current) clearTimeout(typingRef.current);
    };
  }, [currentIndex]);

  return (
    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n      {/* First 8 Talents Card */}\n      <div className=\"bg-gradient-to-br from-school-gold-50 to-school-red-50 rounded-3xl p-8 shadow-lg\">\n        <h3 className=\"text-2xl font-bold text-school-navy-700 mb-6\">Core Talents</h3>\n        <ul className=\"space-y-4\">\n          {firstEightTalents.map((talent, index) => (\n            <li key={index} className=\"flex items-start gap-3\">\n              <span className=\"flex-shrink-0 w-8 h-8 bg-school-red-600 text-white rounded-full flex items-center justify-center font-bold text-sm\">\n                {index + 1}\n              </span>\n              <span className=\"text-gray-700 text-base leading-relaxed pt-1\">{talent}</span>\n            </li>\n          ))}\n        </ul>\n      </div>\n\n      {/* Typing Animation Card */}\n      <div className=\"bg-gradient-to-br from-school-navy-50 to-school-gold-50 rounded-3xl p-8 shadow-lg flex flex-col justify-center\">\n        <h3 className=\"text-2xl font-bold text-school-navy-700 mb-6\">Additional Talents</h3>\n        <div className=\"bg-white rounded-2xl p-8 min-h-[200px] flex items-center justify-center shadow-inner\">\n          <p className=\"text-2xl text-gray-700 font-medium text-center leading-relaxed\">\n            {typingText}\n            <span className=\"inline-block w-1 h-6 bg-school-red-600 ml-1 animate-pulse\" />\n          </p>\n        </div>\n        <p className=\"text-sm text-gray-500 text-center mt-4\">Showcasing more amazing achievements...</p>\n      </div>\n    </div>\n  );\n}

export default function AboutUs() {
  const sectionRef = useRef<HTMLElement>(null);

  useEffect(() => {
    const ctx = gsap.context(() => {
      // Animate each row as it comes into view
      gsap.utils.toArray('.about-row').forEach((row: any) => {
        gsap.from(row, {
          scrollTrigger: {
            trigger: row,
            start: 'top 80%',
          },
          y: 50,
          opacity: 0,
          duration: 1,
          ease: 'power3.out',
        });
      });
    }, sectionRef);

    return () => ctx.revert();
  }, []);

  return (
    <section id="about" ref={sectionRef} className="relative py-20 px-4 bg-gradient-to-b from-white via-blue-50 to-white overflow-hidden">
    <div className="max-w-7xl mx-auto space-y-32">

         <div className="lg:col-span-2 text-center">
            
            <h2 className="text-4xl md:text-5xl font-serif font-bold mb-8 text-gray-800">
              Welcome to <span className="text-school-navy-700">School of Wonder Kids</span>
            </h2>
            <div className="space-y-6 text-lg text-gray-700 leading-relaxed">
                <p>What is Education? Is it just making students carry a pile of books and recite a few lessons forcefully? Or does it stand for something greater?</p>
              <p>
                For School of Wonder Kids, Education is the most powerful weapon to change the world and imparting the right education, thus, forms the base to make the leaders of tomorrow.
              </p>
              <p>Established in 2001 with the concept of no books-no reading-no writing-no homework for KG classes & no loads of books and no homework from class 1 on wards, School of Wonder Kids in Visakhapatnam and Gajuwaka emerged as India’s most distinct schools and is widely accepted and appreciated by parents and educationalists. The school has won several awards and accolades, and remains a top choice for parents choosing the best school in Visakhapatnam.</p>
            
            </div>
          </div>


          {/* Stats Section */}
        <div className="pt-20">
          <div className="grid grid-cols-2 md:grid-cols-4 gap-8">
            {[
              { number: 500, suffix: '+', label: 'Students', color: 'school-red' },
              { number: 128, suffix: '+', label: 'Records', color: 'school-navy' },
              { number: 100, suffix: '%', label: 'Success Rate', color: 'school-gold' },
              { number: 15, suffix: '+', label: 'Years Experience', color: 'school-red' },
            ].map((stat, index) => (
              <div key={index} className="about-card text-center">
                <div className="bg-white rounded-3xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                  <div className={`text-5xl md:text-6xl font-bold text-${stat.color}-500 mb-3 flex items-center justify-center gap-1`}>
                    <CountUpAnimation target={stat.number} duration={2500} />
                    <span>{stat.suffix}</span>
                  </div>
                  <div className="text-gray-700 font-semibold uppercase text-sm tracking-widest">{stat.label}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
        
        {/* Section 1: CBSE School in Vizag */}
        <div className="about-row grid grid-cols-1 lg:grid-cols-3 gap-12 items-start bg-white rounded-3xl p-8 shadow-lg">
          <div className="lg:col-span-2 text-left">
            <h2 className="text-4xl md:text-5xl font-serif font-bold mb-8 text-gray-800">
              <span className="text-school-navy-700">CBSE School</span> in Vizag
            </h2>
            <div className="space-y-6 text-lg text-gray-700 leading-relaxed">
             <p>School of Wonder Kids was started with a vision to offer education to children in a friendly and playful environment. The burden of heavy baggage, home work and more was done away with. Our main interest is to impart knowledge to the best interests for the future of the children. It is done by analyzing and understanding their strengths and weaknesses. Thereafter, we make their learning cycle simple and easy through tailoring the best possible intelligent solutions that we have on offer. Thus, we dynamically increase their learning skills in a stress-free ecological environment.</p>
              <p>
             We strongly believe that our professional expertise in the field of education prepared with a new concept of School without Books, Reading and Writing, including no home work at all. This will give the kids the time to enjoy their childhood. Play while learning is not an option, it is essential. It definitely helps them to stay healthy and improve their thinking skills.
              </p>
            
            </div>
          </div>
          {/* Right Side Image Placeholders */}
          <div className="grid grid-cols-1 gap-4">
            <div className="aspect-[4/3] bg-gray-100 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400">Image Placeholder 1</div>
            <div className="aspect-[4/3] bg-gray-100 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400">Image Placeholder 2</div>
          </div>
        </div>

        {/* Section 2: Our Kids are our Inspiration */}
        <div className="about-row grid grid-cols-1 lg:grid-cols-3 gap-12 items-start bg-gradient-to-br from-school-navy-50 to-school-gold-50 rounded-3xl p-8">
          <div className="lg:col-span-2 text-left">
            <h2 className="text-4xl md:text-5xl font-serif font-bold mb-8 text-gray-800">
              Our Kids are our <span className="text-school-red-600">Inspiration</span>
            </h2>
            <div className="space-y-8 text-lg text-gray-700 leading-relaxed">
              <div className="bg-white/70 backdrop-blur-sm rounded-2xl p-6">
                <h4 className="font-bold text-school-red-600 mb-2 text-xl">Rajitha</h4>
                <p>Kumari Rajitha, the eldest of the three kids of Malla Ramunaidu and Malla Vani Sri, is the recipient of National Child Award for Exceptional Achievement 1996, in the field of Mathematics. She was honoured by the then HRD Minister Mr. S.R. Bommai in Delhi . Rajitha is proud to be one among the seven child awardees. At the age of six, she could say the day of any given date from any century. Additions and subtractions are her passion, she knows the easiest root for any square root. She received tons of awards for her mathematical genius. Her extraordinary knowledge of multiplications, multiplied her name and fame from East to West.</p>
              </div>
              <div className="bg-white/70 backdrop-blur-sm rounded-2xl p-6">
                <h4 className="font-bold text-school-navy-700 mb-2 text-xl">Karthik</h4>
                <p>If the first is first, the second is better than the first. Karthik, the second son started his career with ‘Ugadi Puraskar’ from Madras Telugu Academy . This itself is a testimony of his world wide knowledge. At the age of 2+ he knew the capital cities of different nations, identified different countries in the world map, recognised the flags of different nations. He could answer more than five thousand questions like the authors of different books, inventors of different inventions, geographical surnames, superlatives, abbreviations etc. Many prestigious organisations conferred upon him titles like Wonder kid, Super kid, Balaratna etc. Awards and encomiums are no new to him.</p>
              </div>
              <div className="bg-white/70 backdrop-blur-sm rounded-2xl p-6">
                <h4 className="font-bold text-school-gold-600 mb-2 text-xl">Sarvani</h4>
                <p>Sarvani, the youngest, has the silver lining right from her infancy. From her cradle she went to the stage to Dance. If she dances a classical item it is a real classic. The melody of her ghungru rings in the inner ears of the audience. Lights are real sights when she dances. Her accuracy, perfection, concentration for dance brought her recognition earlier than her brother and sister. Sarvani’s ‘folk’ is a ‘talk’. Call it a Bhangra, call it a Bharatanatyam, call it a Kuchipudi, she is an amalgam precipitated into artistic form of a professional dancer. Awards made her responsible. She understood the value of ‘recognition’ before she recognised alphabet. All the three attracted wide coverage in dailies, magazines and TV Channels.</p>
              </div>
            </div>
          </div>
          <div className="grid grid-cols-1 gap-4">
            <div className="aspect-square bg-gray-100 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400">Student Achievement 1</div>
            <div className="aspect-square bg-gray-100 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400">Student Achievement 2</div>
          </div>
        </div>

        {/* Section 3: Extra-ordinary Talents List */}
        <div className="about-row">
          <div className="text-center mb-12">
            <h2 className="text-4xl md:text-5xl font-serif font-bold text-gray-800">
              Our students display <span className="text-school-red-600">extra-ordinary talents</span>
            </h2>
          </div>
          <TalentsShowcase />
        </div>

        
      </div>
   
    </section>
  );
}
